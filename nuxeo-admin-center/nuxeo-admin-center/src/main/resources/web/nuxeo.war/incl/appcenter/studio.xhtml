<div xmlns:h="http://java.sun.com/jsf/html"
  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:c="http://java.sun.com/jstl/core">

  <a4j:outputPanel id="connectAppListing">

    <div class="actionBar marketplace">
      <span class="marketplaceLogo">
        <a target="_blank" href="http://doc.nuxeo.com/x/EIAV">
          <img src="#{contextPath}/img/nuxeo_studio_logo.png"
            alt="Nuxeo Studio" />
        </a>
      </span>
      <span class="label">
        <a target="_blank" href="http://doc.nuxeo.com/x/EIAV"
          class="connectLink">
          <h:outputText value="#{messages['label.tab.studio.intro']}"/>
        </a>
      </span>
    </div>

    <div class="actionBar">

      <div class="studioUpdateActions">
        <h:outputText value="#{messages['label.studio.devmod.title']}"
          styleClass="boldLabel"/>
      </div>
      <div class="studioUpdateActions">
        <h:outputText value="#{messages['label.studio.devmod.desc1']}"/>
        <h:outputText value="#{messages['label.studio.devmod.desc2']}"/><br/>
        <h:outputText value="#{messages['label.studio.devmod.desc3']}"/><br/>
      </div>

      <h:panelGroup>
        <a4j:form id="updateStudioSnapshotForm">
          <div class="studioUpdateActions">
            <table width="100%">
              <tr>
                <td width="70%">
                  <h:outputText value="#{messages['label.studio.update.lastStatus']}"/>
                  <span style="color:green">
                    <h:outputText value="#{appsViews.getStudioInstallationStatus()}" styleClass="boldLabel"/>
                  </span>
                  <c:if test="#{connectServerReachable and registredConnectInstance}">
                    <h:commandButton
                      id="updateStudioButton"
                      onclick="showUpdateInProgress();"
                      value="#{messages['admCommand.studio.update']}"
                      action="#{appsViews.installStudioSnapshotAndRedirect()}"
                      styleClass="button">
                    </h:commandButton>
                    <img src="#{contextPath}/img/big_loading.gif"
                      id="studioUpdateWaiter"
                      style="display:none" height="20"/>
                    <h:outputText value="#{messages['label.studio.update']}"/>
                  </c:if>
                </td>
                <td style="text-align:center;vertical-align:middle">
                  <c:if test="#{connectServerReachable and registredConnectInstance}">
                    <a target="studio" href="#{nuxeoConnectUrl}studio/ide">
                      <img src="#{contextPath}/icons/studio32.png"/>
                      <h:outputText value="#{messages['action.studio.go']}" styleClass="boldLabel"/>
                    </a>
                  </c:if>
                </td>
              </tr>
            </table>
          </div>
        </a4j:form>
      </h:panelGroup>
    </div>
    <br />

    <div class="actionBar">

      <div class="studioUpdateActions">
        <h:outputText value="#{messages['label.studio.prodmod.title']}" styleClass="boldLabel"/>
      </div>
      <div class="studioUpdateActions">
        <h:outputText value="#{messages['label.studio.prodmod.desc1']}" />
        (<a href="http://doc.nuxeo.com/x/OwAz#VersionControl-creatingtag" target="docnuxeocom">
        <h:outputText value="#{messages['label.studio.prodmod.tagLink']}"/></a>)
        <h:outputText value="#{messages['label.studio.prodmod.desc2']}" />
      </div>
      <h:form id="studioTagsUpdate">
        <a4j:commandButton
          value="#{messages['admCommand.studio.refresh']}"
          actionListener="#{appsViews.flushCache()}"
          reRender="connectAppListing"
          eventsQueue="adminCenterQueue"
          styleClass="button" />
        <h:outputText value="#{messages['label.studio.refresh']}" />
      </h:form>
    </div>

<script>
  <!--
  function displayConnectIframe() {
      var margin = 80;
      var min = 200;
      jQuery('#connectLoaderWaiter').css('display','none');
      var h = jQuery(document).height() - jQuery("#beforeIframe").position().top -margin;
      if (h<min) {
        h=min;
      }
      jQuery("#connectIframe").height(h);
      jQuery("#connectIframe").css("display","block");
  }
  function showUpdateInProgress() {
    jQuery("input[type='button'][class='button'][id$='updateStudioButton']").attr("disabled", "disabled");
    jQuery("input[type='button'][class='button'][id$='updateStudioButton']").css("color","#CCCCCC")
    jQuery('#studioUpdateWaiter').css('display','inline');
  }
  -->
</script>

    <c:if test="#{connectServerReachable and registredConnectInstance}">
      <span id="beforeIframe"></span>
      <iframe id="connectIframe"
        src="#{contextPath}/site/connectClient/packages/studio"
        frameborder="0" scrolling="auto" width="100%"
        style="display:none" onload="javascript:displayConnectIframe();">
      </iframe>
      <div id="connectLoaderWaiter" style="width:100%;height:100px;text-align:center">
        <img src="#{contextPath}/img/big_loading.gif"/>
      </div>
    </c:if>

    <c:if test="#{not connectServerReachable}">
      <div class="infoMessage">
        <h:outputText value="#{messages['adminsubtab.servernotreachable']}" />
      </div>
    </c:if>

    <c:if test="#{not registredConnectInstance}">
      <div class="infoMessage">
       <h:outputText value="#{messages['adminsubtab.registrationRequired']}" />
      </div>
    </c:if>

  </a4j:outputPanel>

</div>
