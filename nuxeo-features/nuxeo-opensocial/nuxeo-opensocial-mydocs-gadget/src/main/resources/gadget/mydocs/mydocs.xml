<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="My documents" height="95" scrolling="true"
    scaling="true" directory_title="My Documents"
    description="File browser in the ECM system" author="Damien METZLER"
    author_email="damien.metzler@leroymerlin.fr" author_affiliation="Leroy Merlin"
    author_location="Lezennes, France">

    <Require feature="dynamic-height" />
    <Require feature="settitle" />
    <Require feature="opensocial-0.8" />
    <Require feature="nuxeo" />
    <Require feature="jquery" />
    <Require feature="form" />
  </ModulePrefs>

  <Content type="html" view="default">
<![CDATA[
    <script type="text/javascript" language="javascript" src="documentlists.js"></script>
    <script type="text/javascript">



      gadgets.util.registerOnLoadHandler( function() {
        var cb = function(id) {
          spaceId = id;
          getDocumentLists()
        }
        gadgets.nuxeo.getSpaceId(cb);
      });
    </script>

    <link rel="stylesheet" type="text/css" href="documentlists.css"/>
    <div id="nxDocumentList">
        <div id="nxDocumentListData">
          <img src="/nuxeo/img/standart_waiter.gif">
        </div>
        <div align="center">
            <input type="image" src="/nuxeo/icons/action_page_rewind.gif" onclick="firstPage()"/>
            <input type="image" src="/nuxeo/icons/action_page_previous.gif" onclick="prevPage()"/>
            <span class="currentPageStatus" id="nxDocumentListPage"></span>
            <input type="image" src="/nuxeo/icons/action_page_next.gif" onclick="nextPage()"/>
            <input type="image" src="/nuxeo/icons/action_page_fastforward.gif"onclick="lastPage()"/>
         </div>
         <div id="addfile">
         <form style="text-align:center;" method="post" id="formUpload" enctype="multipart/form-data" action="">
            <input type="file" name="file" id="uploadFile" size="20" /> <input  id="uploadBtn" type="submit" value="Ajouter" />
        </form>

         </div>
    </div>

  ]]>
  </Content>

  <Content type="html" view="canvas">
<![CDATA[
    <script type="text/javascript" language="javascript" src="documentlists.js"></script>
    <script type="text/javascript">
      var spaceId="";
      gadgets.util.registerOnLoadHandler( function() {
        var cb = function(id) {
          spaceId = id;
          makeRequest(getResourceUrl(), onWorkspaceQueried);
       }

       gadgets.nuxeo.getSpaceId(cb);

     });

     var onWorkspaceQueried = function (obj) {
        var jsonObject = obj.data;

        var html="";
        //FIXME: repo id is hard coded
        var iframesrc="/nuxeo/nxdoc/default/" + jsonObject.summary.id + "/view_documents?theme=galaxy/popup";
        html += "<iframe src=\""+ iframesrc + "\" width=\"100%\" height=\"500px\" border=\"0\">";
        _gel("ifplace").innerHTML = html;

        gadgets.window.adjustHeight();
     }


    </script>
    <div id="ifplace"></div>

  ]]>
  </Content>
</Module>
