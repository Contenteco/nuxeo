<?xml version="1.0"?>

<component name="org.nuxeo.theme.jsf.editor.ui">
  <documentation>
    Contributions to the NXThemes Theme Editor. All web features and
    resources specific to the Theme Editor are registered here.
    @author Jean-Marc Orliaguet (jmo@chalmers.se)
  </documentation>

  <extension target="org.nuxeo.theme.services.ThemeService"
    point="shortcuts">

    <shortcut key="-" target="/nuxeo/nxthemes-select?engine=editor" />

    <shortcut key="_" target="/nuxeo/nxthemes-select?engine=editor" />

    <shortcut key="t" target="/nuxeo/nxthemes-select?engine=editor" />

  </extension>


  <extension target="org.nuxeo.theme.services.ThemeService"
    point="resources">

    <resource name="nxthemes-jsf-editor-authoring.js">
      <path>nxthemes/jsf/editor/scripts/authoring.js</path>
      <require>seam-remote.js</require>
    </resource>

    <resource name="nxthemes-jsf-style-editor.js">
      <path>nxthemes/jsf/editor/scripts/style-editor.js</path>
      <require>seam-remote.js</require>
    </resource>

    <resource name="nxthemes-jsf-editor-authoring.css">
      <path>nxthemes/jsf/editor/styles/authoring.css</path>
    </resource>

    <resource name="theme-editor.json">
      <path>
        nxthemes/jsf/editor/models/theme-editor.json
      </path>
    </resource>

    <resource name="element-mover.json">
      <path>
        nxthemes/jsf/editor/controllers/element-mover.json
      </path>
    </resource>

    <resource name="toolbox-mover.json">
      <path>
        nxthemes/jsf/editor/controllers/toolbox-mover.json
      </path>
    </resource>

    <resource name="editor-perspectives.json">
      <path>
        nxthemes/jsf/editor/controllers/editor-perspectives.json
      </path>
    </resource>

    <resource name="editor-buttons.json">
      <path>
        nxthemes/jsf/editor/controllers/editor-buttons.json
      </path>
    </resource>

    <resource name="fragment-inserter.json">
      <path>
        nxthemes/jsf/editor/controllers/fragment-inserter.json
      </path>
    </resource>

    <resource name="perspective-selector.json">
      <path>
        nxthemes/jsf/editor/controllers/perspective-selector.json
      </path>
    </resource>

    <resource name="element-editor-perspectives.json">
      <path>
        nxthemes/jsf/editor/controllers/element-editor-perspectives.json
      </path>
    </resource>

    <resource name="element-form-actions.json">
      <path>
        nxthemes/jsf/editor/controllers/element-form-actions.json
      </path>
    </resource>

    <resource name="fragment-factory-expander.json">
      <path>
        nxthemes/jsf/editor/controllers/fragment-factory-expander.json
      </path>
    </resource>

    <resource name="theme-switcher.json">
      <path>
        nxthemes/jsf/editor/controllers/theme-switcher.json
      </path>
    </resource>

    <resource name="area-style-actions.json">
      <path>
        nxthemes/jsf/editor/controllers/area-style-actions.json
      </path>
    </resource>

    <resource name="area-style-perspectives.json">
      <path>
        nxthemes/jsf/editor/controllers/area-style-perspectives.json
      </path>
    </resource>

    <resource name="layout-editor-actions.json">
      <path>
        nxthemes/jsf/editor/controllers/layout-editor-actions.json
      </path>
    </resource>

    <resource name="style-editor-perspectives.json">
      <path>
        nxthemes/jsf/editor/controllers/style-editor-perspectives.json
      </path>
    </resource>

    <resource name="style-editor-actions.json">
      <path>
        nxthemes/jsf/editor/controllers/style-editor-actions.json
      </path>
    </resource>

    <resource name="style-preview.json">
      <path>
        nxthemes/jsf/editor/views/style-preview.json
      </path>
    </resource>

    <resource name="style-css.json">
      <path>
        nxthemes/jsf/editor/views/style-css.json
      </path>
    </resource>

    <resource name="canvas-mode-selector.json">
      <path>
        nxthemes/jsf/editor/controllers/canvas-mode-selector.json
      </path>
    </resource>

    <resource name="context-menu-actions.json">
      <path>
        nxthemes/jsf/editor/controllers/context-menu-actions.json
      </path>
    </resource>

    <resource name="context-menu.json">
      <path>nxthemes/jsf/editor/views/context-menu.json</path>
    </resource>

    <resource name="toggle-context-menu.json">
      <path>
        nxthemes/jsf/editor/controllers/toggle-context-menu.json
      </path>
    </resource>

    <resource name="link-disabler.json">
      <path>
        nxthemes/jsf/editor/controllers/link-disabler.json
      </path>
    </resource>

  </extension>

  <extension target="org.nuxeo.theme.services.ThemeService"
    point="standalone-filters">

    <standalone-filter name="control fragment visibility">
      <engine>page-editor</engine>
      <class>
        org.nuxeo.theme.jsf.editor.filters.FragmentVisibility
      </class>
    </standalone-filter>

    <standalone-filter name="set element id">
      <engine>page-editor</engine>
      <class>org.nuxeo.theme.jsf.editor.filters.ElementUid</class>
    </standalone-filter>

    <standalone-filter name="make draggable">
      <engine>page-editor</engine>
      <class>org.nuxeo.theme.jsf.editor.filters.Draggable</class>
    </standalone-filter>

    <standalone-filter name="remove scripts">
      <engine>page-editor</engine>
      <class>
        org.nuxeo.theme.jsf.editor.filters.ScriptRemover
      </class>
    </standalone-filter>

    <standalone-filter name="insert json model">
      <engine>page-editor</engine>
      <class>org.nuxeo.theme.jsf.editor.filters.JSONModel</class>
    </standalone-filter>

    <standalone-filter name="create initial section">
      <engine>page-editor</engine>
      <class>
        org.nuxeo.theme.jsf.editor.filters.CreateInitialSection
      </class>
    </standalone-filter>

    <standalone-filter name="add identifiable container">
      <engine>fragments-only</engine>
      <class>
        org.nuxeo.theme.jsf.editor.filters.IdentifiableContainer
      </class>
    </standalone-filter>

  </extension>

  <extension target="org.nuxeo.theme.services.ThemeService"
    point="views">

    <view name="theme view">
      <engine>editor</engine>
      <element-type>theme</element-type>
      <format-type>widget</format-type>
      <class>org.nuxeo.theme.jsf.views.JSFView</class>
      <template>
        nxthemes/jsf/editor/widgets/theme-view.xml
      </template>
      <resource>nxthemes-jsf.css</resource>
      <resource>nxthemes-widgets.js</resource>
      <resource>nxthemes-controllers.js</resource>
      <resource>nxthemes-jsf-editor-authoring.js</resource>
      <resource>nxthemes-jsf-editor-authoring.css</resource>
    </view>

    <!--  Pages -->
    <view name="page frame">
      <engine>page-editor</engine>
      <element-type>page</element-type>
      <format-type>widget</format-type>
      <class>org.nuxeo.theme.jsf.views.JSFView</class>
      <template>
        nxthemes/jsf/editor/widgets/page-frame.xml
      </template>
    </view>

    <view name="page frame">
      <engine>page-editor</engine>
      <mode>area-styles-page</mode>
      <element-type>page</element-type>
      <format-type>widget</format-type>
      <class>org.nuxeo.theme.jsf.editor.views.PageFrameAreaStyle</class>
    </view>

    <view name="page frame">
      <engine>page-editor</engine>
      <mode>area-styles-section</mode>
      <element-type>page</element-type>
      <format-type>widget</format-type>
      <class>org.nuxeo.theme.jsf.views.JSFView</class>
      <template>
        nxthemes/jsf/editor/widgets/page-frame.xml
      </template>
    </view>

    <view name="page frame">
      <engine>page-editor</engine>
      <mode>area-styles-cell</mode>
      <element-type>page</element-type>
      <format-type>widget</format-type>
      <class>org.nuxeo.theme.jsf.views.JSFView</class>
      <template>
        nxthemes/jsf/editor/widgets/page-frame.xml
      </template>
    </view>


    <!-- sections -->
    <view name="section frame">
      <engine>page-editor</engine>
      <element-type>section</element-type>
      <format-type>widget</format-type>
      <class>org.nuxeo.theme.jsf.views.JSFView</class>
      <template>
        nxthemes/jsf/editor/widgets/section-frame.xml
      </template>
    </view>

    <view name="section frame">
      <engine>page-editor</engine>
      <mode>area-styles-section</mode>
      <element-type>section</element-type>
      <format-type>widget</format-type>
      <class>org.nuxeo.theme.jsf.editor.views.SectionFrameAreaStyle</class>
    </view>

    <view name="section frame">
      <engine>page-editor</engine>
      <mode>area-styles-cell</mode>
      <element-type>section</element-type>
      <format-type>widget</format-type>
      <class>org.nuxeo.theme.jsf.views.JSFView</class>
      <template>
        nxthemes/jsf/editor/widgets/section-frame.xml
      </template>
    </view>

    <view>
      <engine>page-editor</engine>
      <mode>layout</mode>
      <element-type>section</element-type>
      <format-type>layout</format-type>
      <class>
        org.nuxeo.theme.jsf.editor.views.SectionLayout
      </class>
    </view>

    <!-- cell -->
    <view name="cell frame">
      <engine>page-editor</engine>
      <element-type>cell</element-type>
      <format-type>widget</format-type>
      <class>
        org.nuxeo.theme.jsf.editor.views.CellFrameWidget
      </class>
    </view>

    <view name="cell frame">
      <engine>page-editor</engine>
      <mode>area-styles-cell</mode>
      <element-type>cell</element-type>
      <format-type>widget</format-type>
      <class>org.nuxeo.theme.jsf.editor.views.CellFrameAreaStyle</class>
    </view>

    <view>
      <engine>page-editor</engine>
      <mode>layout</mode>
      <element-type>cell</element-type>
      <format-type>layout</format-type>
      <class>org.nuxeo.theme.jsf.editor.views.CellLayout</class>
    </view>

    <!-- Override the default style view in layout mode-->
    <view>
      <engine>page-editor</engine>
      <mode>layout</mode>
      <format-type>style</format-type>
      <class>org.nuxeo.theme.jsf.filters.BypassView</class>
    </view>

  </extension>

  <extension target="org.nuxeo.theme.services.ThemeService"
    point="engines">

    <engine name="editor">

      <renderer element="theme">
        <filter>add widget</filter>
        <filter>collect xmlns</filter>
      </renderer>

      <renderer element="page" />

      <renderer element="section" />

      <renderer element="cell" />

      <renderer element="fragment" />

    </engine>

    <engine name="page-editor">

      <renderer element="theme" />

      <renderer element="page">
        <filter>add widget</filter>
        <filter>collect xmlns</filter>
        <filter>set style</filter>
        <filter>set layout</filter>
        <filter>set element id</filter>
        <filter>create initial section</filter>
      </renderer>

      <renderer element="section">
        <filter>add widget</filter>
        <filter>remove scripts</filter>
        <filter>set style</filter>
        <filter>set layout</filter>
        <filter>set element id</filter>
      </renderer>

      <renderer element="cell">
        <filter>add widget</filter>
        <filter>set style</filter>
        <filter>set layout</filter>
        <filter>set element id</filter>
        <filter>insert json model</filter>
      </renderer>

      <renderer element="fragment">
        <filter>add widget</filter>
        <filter>set style</filter>
        <filter>control fragment visibility</filter>
        <filter>make draggable</filter>
        <filter>set element id</filter>
        <filter>insert json model</filter>
      </renderer>

    </engine>

    <engine name="fragments-only">

      <renderer element="theme">
        <filter>add widget</filter>
        <filter>collect xmlns</filter>
      </renderer>

      <renderer element="page">
        <filter>add widget</filter>
      </renderer>

      <renderer element="section" />

      <renderer element="cell" />

      <renderer element="fragment">
        <filter>add widget</filter>
        <filter>add identifiable container</filter>
        <!--  filter>write fragment tag</filter -->
      </renderer>

    </engine>

  </extension>

</component>
