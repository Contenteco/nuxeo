# (C) Copyright 2008-2010 Nuxeo SA (http://nuxeo.com/) and contributors.
#
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the GNU Lesser General Public License
# (LGPL) version 2.1 which accompanies this distribution, and is available at
# http://www.gnu.org/licenses/lgpl.html
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# Lesser General Public License for more details.
#
# Contributors:
#     Florent Guillaume

# Variables used:
# ${idType} varchar(36)

############################################################


#CATEGORY: testUpgrade

# here use a TEXT instead of a VARCHAR to test compatibility
CREATE TABLE testschema2 (
  id ${idType} NOT NULL PRIMARY KEY,
  title text
);

# create the old structure for tags tables

CREATE TABLE tag (
  id ${idType} NOT NULL, -- actually foreign key to hierarchy
  private BIGINT,
  label VARCHAR
);

CREATE TABLE nxp_tagging (
  id VARCHAR(255) NOT NULL,
  tag_id VARCHAR(255),
  author VARCHAR(255),
  document_id VARCHAR(255),
  creation_date DATE,
  is_private INTEGER
);



#CATEGORY: testUpgradeOldTables

# create old values in old tables

# root & repository
INSERT INTO hierarchy (id, parentid, name, isproperty, primarytype)
  VALUES ('00000000-0000-0000-0000-000000000000', null, '', false, 'Root')

INSERT INTO repositories (id, name) VALUES ('00000000-0000-0000-0000-000000000000', 'default')

# fake doc to tag
INSERT INTO hierarchy (id, parentid, name, isproperty, primarytype)
  VALUES ('dddddddd-dddd-dddd-dddd-dddddddddddd', null, 'mydoc', false, 'TestDoc')

# tags root
INSERT INTO hierarchy (id, parentid, name, isproperty, primarytype)
  VALUES ('aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', '00000000-0000-0000-0000-000000000000', 'tags', false, 'HiddenFolder')

# tag hier
INSERT INTO hierarchy (id, parentid, name, isproperty, primarytype)
  VALUES ('11111111-2222-3333-4444-555555555555', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'mytag', false, 'Tag')

# tag
INSERT INTO tag (id, private, label) VALUES ('11111111-2222-3333-4444-555555555555', 0, 'mytag');

# tag dublincore
INSERT INTO dublincore (id, creator, title) VALUES ('11111111-2222-3333-4444-555555555555', 'Administrator', 'mytag');

# tag 2 (unused) hier
INSERT INTO hierarchy (id, parentid, name, isproperty, primarytype)
  VALUES ('ffffffff-ffff-ffff-1111-111111111111', 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa', 'othertag', false, 'Tag')

# tag 2
INSERT INTO tag (id, private, label) VALUES ('ffffffff-ffff-ffff-1111-111111111111', 0, 'othertag');

# tag 2 dublincore
INSERT INTO dublincore (id, creator, title) VALUES ('ffffffff-ffff-ffff-1111-111111111111', 'Administrator', 'othertag');

# tagging
INSERT INTO nxp_tagging (id, tag_id, author, document_id, creation_date, is_private)
  VALUES (123123123, '11111111-2222-3333-4444-555555555555', 'Administrator', 'dddddddd-dddd-dddd-dddd-dddddddddddd', DATE '2010-06-01', 0);
